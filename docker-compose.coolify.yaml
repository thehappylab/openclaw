services:
  openclaw:
    image: 'ghcr.io/thehappylab/openclaw:2026.2.16-5'
    environment:
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}

      - OPENCLAW_PRIMARY_MODEL=${PRIMARY_MODEL}
      - OPENCLAW_PREINSTALL_SKILLS=${OPENCLAW_PREINSTALL_SKILLS}
      - OPENCLAW_STATE_DIR=/data/.openclaw
      - OPENCLAW_WORKSPACE_DIR=/data/workspace
      - OPENCLAW_DOCKER_APT_PACKAGES=${OPENCLAW_DOCKER_APT_PACKAGES}
      - OPENCLAW_GATEWAY_TOKEN=$SERVICE_PASSWORD_64_GATEWAYTOKEN
      - OPENCLAW_CUSTOM_CONFIG=${OPENCLAW_CUSTOM_CONFIG}
      
      - GH_TOKEN=${GH_TOKEN}
      - BW_SERVER=${BW_SERVER}
      - BW_CLIENTID=${BW_CLIENTID}
      - BW_CLIENTSECRET=${BW_CLIENTSECRET}
      - COOLIFY_API_URL=${COOLIFY_API_URL}
      - COOLIFY_API_TOKEN=${COOLIFY_API_TOKEN}
      - UMAMI_API_URL=${UMAMI_API_URL}
      - UMAMI_API_TOKEN=${UMAMI_API_TOKEN}
      
      - DISCORD_GROUP_POLICY=${DISCORD_GROUP_POLICY:-open}
      - DISCORD_GROWTH_BOT_TOKEN=${DISCORD_GROWTH_BOT_TOKEN}
      - DISCORD_BUILDER_BOT_TOKEN=${DISCORD_BUILDER_BOT_TOKEN}
      - DISCORD_OPERATION_BOT_TOKEN=${DISCORD_OPERATION_BOT_TOKEN}
            
      - AUTH_USERNAME=$SERVICE_USER_OPENCLAW
      - AUTH_PASSWORD=$SERVICE_PASSWORD_OPENCLAW

      - 'BROWSER_CDP_URL=http://browser:9223'
      - 'BROWSER_DEFAULT_PROFILE=${BROWSER_DEFAULT_PROFILE:-openclaw}'
      - 'BROWSER_EVALUATE_ENABLED=${BROWSER_EVALUATE_ENABLED:-true}'
      - 'BROWSER_SNAPSHOT_MODE=${BROWSER_SNAPSHOT_MODE:-efficient}'
      - 'HOOKS_ENABLED=${HOOKS_ENABLED:-false}'

      - BRAVE_WEBSEARCH_API_KEY=${BRAVE_WEBSEARCH_API_KEY}

    volumes:
      - 'openclaw-data:/data'
    depends_on:
      browser:
        condition: service_healthy
    healthcheck:
      test:
        - CMD
        - curl
        - '-sf'
        - 'http://127.0.0.1:8080/healthz'
      interval: 10s
      timeout: 10s
      retries: 5
  browser:
    image: 'coollabsio/openclaw-browser:latest'
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Etc/UTC
      - CHROME_CLI=--remote-debugging-port=9222
    volumes:
      - 'browser-data:/config'
    shm_size: 2g
    healthcheck:
      test:
        - CMD-SHELL
        - "bash -c ':> /dev/tcp/127.0.0.1/9222' || exit 1"
      interval: 5s
      timeout: 5s
      retries: 10
